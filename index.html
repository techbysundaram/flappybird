<html>
<link href="./style.css" rel="stylesheet" />

<body>
    <canvas id="gameCanvas" style="border: 10px solid black;" width="1000" height="800"></canvas>
</body>
<script>
    let canvas = document.getElementById("gameCanvas");
    let ctx = canvas.getContext("2d");

    // Bird state
    let birdY = 200;
    let birdVelocity = 0;
    let gravity = 0.5;
    let birdSize = 40;

    // Walls state
    let wallX = canvas.width;
    let wallWidth = 100;
    let gapHeight = 200;
    let wallHeight = Math.floor(Math.random() * 300) + 100;
    let wallSpeed = 5;

    // Key input
    document.onkeydown = function () {
        birdVelocity = -10; // jump
    };

    function resetWalls() {
        wallX = canvas.width;
        wallHeight = Math.floor(Math.random() * 300) + 100;
    }

    function updateBird() {
        birdVelocity += gravity;
        birdY += birdVelocity;

        // ground or ceiling check
        if (birdY + birdSize > canvas.height || birdY < 0) {
            gameOver();
        }
    }

    function updateWalls() {
        wallX -= wallSpeed;
        if ((wallX + wallWidth)/2 < 0) {
            resetWalls();
        }
    }

    function checkCollision() {
        // bird hitting walls
        if (
            wallX < 60 && wallX + wallWidth > 20 // horizontal overlap
        ) {
            if (
                birdY < wallHeight || birdY + birdSize > wallHeight + gapHeight
            ) {
                gameOver();
            }
        }
    }

    function drawBird() {
        ctx.fillStyle = "blue";
        ctx.fillRect(20, birdY, birdSize, birdSize);
    }

    function drawWalls() {
        ctx.fillStyle = "green";
        // top wall
        ctx.fillRect(wallX, 0, wallWidth, wallHeight);
        // bottom wall
        ctx.fillRect(wallX, wallHeight + gapHeight, wallWidth, canvas.height);
    }

    function gameOver() {
        alert("You Lost!");
        document.location.reload();
    }

    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        updateBird();
        updateWalls();
        checkCollision();

        drawBird();
        drawWalls();

        requestAnimationFrame(gameLoop);
    }

    function main() {
        gameLoop();
    }

    main();
</script>
</html>
