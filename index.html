<html>
<link href="./style.css" rel="stylesheet" />

<body>
    <canvas id="gameCanvas" style="border: 10px solid black;" width="1000" height="800"></canvas>
</body>
<script>
    let canvas = document.getElementById("gameCanvas");
    let ctx = canvas.getContext("2d");

    // Bird state
    let birdY = 200;
    let birdVelocity = 0;
    let gravity = 0.5;
    let birdSize = 40;

    // Walls state (multiple)
    let walls = [];
    let wallWidth = 100;
    let gapHeight = 200;
    let wallSpeed = 5;
    let wallSpacing = 300; // distance between walls

    // Key input
    document.onkeydown = function () {
        birdVelocity = -10; // jump
    };

    function addWall(startX) {
        let wallHeight = Math.floor(Math.random() * 300) + 100;
        walls.push({
            x: startX,
            height: wallHeight
        });
    }

    function updateBird() {
        birdVelocity += gravity;
        birdY += birdVelocity;

        // ground or ceiling check
        if (birdY + birdSize > canvas.height || birdY < 0) {
            gameOver();
        }
    }

    function updateWalls() {
        for (let wall of walls) {
            wall.x -= wallSpeed;
        }

        // remove walls that go off screen
        if (walls.length && walls[0].x + wallWidth < 0) {
            walls.shift();
        }

        // add new wall if last one is far enough
        if (walls[walls.length - 1].x < canvas.width - wallSpacing) {
            addWall(canvas.width);
        }
    }

    function checkCollision() {
        for (let wall of walls) {
            if (
                wall.x < 60 && wall.x + wallWidth > 20 // horizontal overlap
            ) {
                if (
                    birdY < wall.height ||
                    birdY + birdSize > wall.height + gapHeight
                ) {
                    gameOver();
                }
            }
        }
    }

    function drawBird() {
        ctx.fillStyle = "blue";
        ctx.fillRect(20, birdY, birdSize, birdSize);
    }

    function drawWalls() {
        ctx.fillStyle = "green";
        for (let wall of walls) {
            // top wall
            ctx.fillRect(wall.x, 0, wallWidth, wall.height);
            // bottom wall
            ctx.fillRect(wall.x, wall.height + gapHeight, wallWidth, canvas.height);
        }
    }

    function gameOver() {
        alert("You Lost!");
        document.location.reload();
    }

    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        updateBird();
        updateWalls();
        checkCollision();

        drawBird();
        drawWalls();

        requestAnimationFrame(gameLoop);
    }

    function main() {
        // start with a couple of walls
        addWall(canvas.width);
        addWall(canvas.width + wallSpacing);
        gameLoop();
    }

    main();
</script>
</html>
